# Homework №14

## Задание

1. Создать с помощью Terraform две конфигурации в любом облачном провайдере (предварительно
выполнив регистрацию в облаке), имеющем Terrafrom-провайдера, которые:
1. Создает две подсети private и public в VPC по умолчанию
2. Создает в каждой подсети ВМ:
- к ВМ в public разрешает подключение по ssh, http(s)
- к ВМ в private разрешает подключение по ssh, 8080
- устанавливает на ВМ Nginx с помощью любого провижинера terraform
2. Вручную создать ВМ в любой подсети и выполнить импорт ресурса в ранее созданную вторую
конфигурацию terraform любым методом.

## Заметки

### Установка

- Terraform install https://developer.hashicorp.com/terraform/install
- Скачать AMD версию
- `sudo mv terraform /usr/local/bin/`
- `sudo chmod +x /usr/local/bin/terraform`
- `terraform version`

### Начало работы с Terraform

- `terraform init`
- `terraform plan`

### Начало работы с Terraform в Яндекс.Cloud

- https://yandex.cloud/ru/docs/tutorials/infrastructure-management/terraform-quickstart
- Создание сервисных ключей https://yandex.cloud/ru/docs/iam/operations/authorized-key/create
- Установка Yandex CLI https://yandex.cloud/ru/docs/cli/quickstart#install
  - Установка
  - `source ~/.zshrc` - перезапуск оболочки
  - Получить OAuth-токен
  - `yc init`
  - Создаем профиль
  - выбрал ru-central1-a
- Создать сервисный аккаунт `yc iam service-account create --name <имя_сервисного_аккаунта>`
- `yc iam service-account create --name codeby-devops`
- До этого уже создал сервисный аккаунт вручную с ключами, которые скачал
- Посмотреть список сервисных аккаунтов `yc iam service-account list`
- Создаем профиль `yc config profile create <имя_профиля>`
- `yc config profile create profile-svidpro`
- Конфигурация профиля
```shell
yc config set service-account-key key.json
yc config set cloud-id <идентификатор_облака> - это слева в меню консоли самый верхний уровень облако
yc config set folder-id <идентификатор_каталога> - кликаем на облако и смотрим список каталогов - идентификатор справа
```
- Добавление в переменные окружения
```shell
export YC_TOKEN=$(yc iam create-token)
export YC_CLOUD_ID=$(yc config get cloud-id)
export YC_FOLDER_ID=$(yc config get folder-id)
```
- Добавлем в файл `vi ~/.terraformrc`
  - Блок
```shell
provider_installation {
  network_mirror {
    url = "https://terraform-mirror.yandexcloud.net/"
    include = ["registry.terraform.io/*/*"]
  }
  direct {
    exclude = ["registry.terraform.io/*/*"]
  }
}
```
- 